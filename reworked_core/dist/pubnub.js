!function e(n,t,r){function i(a,s){if(!t[a]){if(!n[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[a]={exports:{}};n[a][0].call(l.exports,function(e){var t=n[a][1][e];return i(t?t:e)},l,l.exports,e,n,t,r)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n["default"]=e,n}function o(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function a(){return"x"+ ++A+ +new Date}function s(){return+new Date}function u(e,n){var t=e.join(URLBIT),r=[];return n?(g(n,function(e,n){var t="object"==("undefined"==typeof n?"undefined":o(n))?JSON.stringify(n):n;"undefined"!=typeof n&&null!=n&&v(t).length>0&&r.push(e+"="+v(t))}),t+="?"+r.join(PARAMSBIT)):t}function c(e,n){var t,r=0,i=function o(){r+n>s()?(clearTimeout(t),t=setTimeout(o,n)):(r=s(),e())};return i}function l(e,n){var t=[];return g(e||[],function(e){n(e)&&t.push(e)}),t}function f(e,n){return e.replace(I,function(e,t){return n[t]||e})}function p(e,n){return setTimeout(e,n)}function h(e){var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)});return e&&e(n),n}function d(e){return!!e&&"string"!=typeof e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length)}function g(e,n){if(e&&n)if(d(e))for(var t=0,r=e.length;r>t;)n.call(e[t],e[t],t++);else for(var t in e)e.hasOwnProperty&&e.hasOwnProperty(t)&&n.call(e[t],t,e[t])}function y(e,n){var t=[];return g(e||[],function(e,r){t.push(n(e,r))}),t}function b(e){return encodeURIComponent(e).replace(/[!'()*~]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function v(e){return encodeURIComponent(e)}function m(e,n){var t=[];return g(e,function(e,r){n?e.search("-pnpres")<0&&r.subscribed&&t.push(e):r.subscribed&&t.push(e)}),t.sort()}function _(e,n){var t=[];return g(e,function(e,r){n?e.search("-pnpres")<0&&r.subscribed&&t.push(e):r.subscribed&&t.push(e)}),t.sort()}function x(){p(function(){T||(T=1,g(C,function(e){e()}))},q)}function j(e){function t(e){return e||(e={}),g(Ee,function(n,t){n in e||(e[n]=t)}),e}function r(e){var n=[];return g(e,function(e,t){n.push(e)}),n}function i(e){return r(e).sort()}function j(e){var n="",t=i(e);for(var r in t){var o=t[r];n+=o+"="+b(e[o]),r!=t.length-1&&(n+="&")}return n}function w(e,n,t){var r=!1;if("undefined"==typeof e)return n;if("number"==typeof e)r=e>D||0==e?!1:!0;else{if("boolean"==typeof e)return e?H:0;r=!0}return r?(t&&t("Presence Heartbeat value invalid. Valid range ( x > "+D+" or x = 0). Current Value : "+(n||D)),n||D):e}function O(e,n){return Fe.encrypt(e,n||Ie)||e}function A(e,n){return Fe.decrypt(e,n||Ie)||Fe.decrypt(e,Ie)||e}function I(){return clearTimeout(Ae),!Ce||Ce>=500||1>Ce||!m(we,!0).length&&!_(Oe,!0).length?void(Pe=!1):(Pe=!0,void ze.presence_heartbeat({callback:function(e){Ae=p(I,Ce*q)},error:function(e){qe&&qe("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),Ae=p(I,Ce*q)}}))}function K(){!Pe&&I()}function U(e){if(Le){if(!ge.length)return}else{if(e&&(ge.sending=0),ge.sending||!ge.length)return;ge.sending=1}xdr(ge.shift())}function G(e){var n=0;return g(_(Oe),function(t){var r=Oe[t];r&&(n++,(e||function(){})(r))}),n}function J(e){var n=0;return g(m(we),function(t){var r=we[t];r&&(n++,(e||function(){})(r))}),n}function X(e,n,t){if("object"==("undefined"==typeof e?"undefined":o(e))){if(e.error){var r={};return e.message&&(r.message=e.message),e.payload&&(r.payload=e.payload),void(t&&t(r))}if(e.payload)return void(e.next_page?n&&n(e.payload,e.next_page):n&&n(e.payload))}n&&n(e)}function F(e,n){if("object"==("undefined"==typeof e?"undefined":o(e))&&e.error){var t={};return e.message&&(t.message=e.message),e.payload&&(t.payload=e.payload),void(n&&n(t))}n&&n(e)}function z(e,n,r,i){var n=e.callback||n,o=e.error||qe,a=He();i=i||{},i.auth||(i.auth=e.auth_key||se);var s=[pe,"v1","channel-registration","sub-key",ae];s.push.apply(s,r),a&&(i.callback=a),xdr({callback:a,data:t(i),success:function(e){X(e,n,o)},fail:function(e){F(e,o)},url:s})}function B(){De()||V(1,{error:"Offline. Please check your network settings. "}),Y&&clearTimeout(Y),Y=p(B,q)}function $(){re&&ze.time(function(e){Q(function(){},e),e||V(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),Z&&clearTimeout(Z),Z=p($,te)})}function V(e,n){_e&&_e(e,n),_e=null,clearTimeout(Y),clearTimeout(Z)}function W(e){var n=s()-be;return n-e/1e4}function Q(e,n){function t(n){if(n){var t=n/1e4,i=(s()-r)/2;be=s()-(t+i),e&&e(be)}}var r=s();n&&t(n)||ze.time(t)}var Y,Z,ee=+e.windowing||L,ne=(+e.timeout||S)*q,te=(+e.keepalive||E)*q,re=e.timecheck||0,ie=e.noleave||0,oe=e.publish_key,ae=e.subscribe_key,se=e.auth_key||"",ue=e.secret_key||"",ce=e.hmac_SHA256,le=e.ssl?"s":"",fe="http"+le+"://"+(e.origin||"pubsub.pubnub.com"),pe=N(fe),he=N(fe),de=function(){},ge=[],ye=!0,be=0,ve=0,me=0,_e=0,ke=e.restore||0,xe=0,je=!1,we={},Oe={},Me={},Ae=null,Te=w(e.heartbeat||e.pnexpires||0,e.error),Ce=e.heartbeat_interval||Te/2-1,Pe=!1,Le=e.no_wait_for_pending,Se=e["compatible_3.5"]||!1,Ee=e.params||{},qe=e.error||function(){},De=e._is_online||function(){return 1},He=e.jsonp_cb||function(){return 0},Re=e.db||{get:function(){},set:function(){}},Ie=e.cipher_key,Ne=e.uuid||!e.unique_uuid&&Re&&Re.get(ae+"uuid")||"",Ke=e.instance_id||!1,Ue="",Ge=e.shutdown,Je="undefined"!=typeof e.use_send_beacon?e.use_send_beacon:!0,Xe=Je?e.sendBeacon:null;2===Te&&(Ce=1);var Fe=e.crypto_obj||{encrypt:function(e,n){return e},decrypt:function(e,n){return e}},ze={LEAVE:function(e,n,r,i,o){var a,s,c={uuid:Ne,auth:r||se},l=N(fe),i=i||function(){},f=o||function(){},p=He();if(e.indexOf(P)>0)return!0;if(Se){if(!le)return!1;if("0"==p)return!1}return ie?!1:("0"!=p&&(c.callback=p),Ke&&(c.instanceid=Ue),a=[l,"v2","presence","sub_key",ae,"channel",v(e),"leave"],s=t(c),Xe&&(url_string=u(a,s),Xe(url_string))?(i&&i({status:200,action:"leave",message:"OK",service:"Presence"}),!0):(xdr({blocking:n||le,callback:p,data:s,success:function(e){X(e,i,f)},fail:function(e){F(e,f)},url:a}),!0))},LEAVE_GROUP:function(e,n,r,i,o){var a,s,c={uuid:Ne,auth:r||se},l=N(fe),i=i||function(){},f=o||function(){},p=He();if(e.indexOf(P)>0)return!0;if(Se){if(!le)return!1;if("0"==p)return!1}return ie?!1:("0"!=p&&(c.callback=p),e&&e.length>0&&(c["channel-group"]=e),Ke&&(c.instanceid=Ue),a=[l,"v2","presence","sub_key",ae,"channel",v(","),"leave"],s=t(c),Xe&&(url_string=u(a,s),Xe(url_string))?(i&&i({status:200,action:"leave",message:"OK",service:"Presence"}),!0):(xdr({blocking:n||le,callback:p,data:s,success:function(e){X(e,i,f)},fail:function(e){F(e,f)},url:a}),!0))},set_resumed:function(e){je=e},get_cipher_key:function(){return Ie},set_cipher_key:function(e){Ie=e},raw_encrypt:function(e,n){return O(e,n)},raw_decrypt:function(e,n){return A(e,n)},get_heartbeat:function(){return Te},set_heartbeat:function(e,n){Te=w(e,Te,qe),Ce=n||Te/2-1,2==Te&&(Ce=1),de(),I()},get_heartbeat_interval:function(){return Ce},set_heartbeat_interval:function(e){Ce=e,I()},get_version:function(){return R},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var n={aps:{badge:1,alert:""}};for(k in e)k[n]=e[k];return n},newPnMessage:function(){var e={};gcm&&(e.pn_gcm=gcm),apns&&(e.pn_apns=apns);for(k in n)e[k]=n[k];return e},_add_param:function(e,n){Ee[e]=n},channel_group:function Be(e,n){var t,Be,r=e.channel_group,n=n||e.callback,i=e.channels||e.channel,o=e.cloak,a=[],s={},u=e.mode||"add";if(r){var c=r.split(":");c.length>1?(t="*"===c[0]?null:c[0],Be=c[1]):Be=c[0]}t&&a.push("namespace")&&a.push(v(t)),a.push("channel-group"),Be&&"*"!==Be&&a.push(Be),i?(d(i)&&(i=i.join(",")),s[u]=i,s.cloak=ye?"true":"false"):"remove"===u&&a.push("remove"),"undefined"!=typeof o&&(s.cloak=o?"true":"false"),z(e,n,a,s)},channel_group_list_groups:function(e,n){var t;t=e.namespace||e.ns||e.channel_group||null,t&&(e.channel_group=t+":*"),ze.channel_group(e,n)},channel_group_list_channels:function(e,n){return e.channel_group?void ze.channel_group(e,n):qe("Missing Channel Group")},channel_group_remove_channel:function(e,n){return e.channel_group?e.channel||e.channels?(e.mode="remove",void ze.channel_group(e,n)):qe("Missing Channel"):qe("Missing Channel Group")},channel_group_remove_group:function(e,n){return e.channel_group?e.channel?qe("Use channel_group_remove_channel if you want to remove a channel from a group."):(e.mode="remove",void ze.channel_group(e,n)):qe("Missing Channel Group")},channel_group_add_channel:function(e,n){return e.channel_group?e.channel||e.channels?void ze.channel_group(e,n):qe("Missing Channel"):qe("Missing Channel Group")},channel_group_cloak:function(e,n){return"undefined"==typeof e.cloak?void n(ye):(ye=e.cloak,void ze.channel_group(e,n))},channel_group_list_namespaces:function(e,n){var t=["namespace"];z(e,n,t)},channel_group_remove_namespace:function(e,n){var t=["namespace",e.namespace,"remove"];z(e,n,t)},history:function(e,n){var n=e.callback||n,r=e.count||e.limit||100,i=e.reverse||"false",a=e.error||function(){},s=e.auth_key||se,u=e.cipher_key,c=e.channel,l=e.channel_group,f=e.start,p=e.end,h=e.include_token,d=e.string_message_token||!1,g={},y=He();return c||l?n?ae?(g.stringtoken="true",g.count=r,g.reverse=i,g.auth=s,l&&(g["channel-group"]=l,c||(c=",")),y&&(g.callback=y),f&&(g.start=f),p&&(g.end=p),h&&(g.include_token="true"),d&&(g.string_message_token="true"),void xdr({callback:y,data:t(g),success:function(e){if("object"==("undefined"==typeof e?"undefined":o(e))&&e.error)return void a({message:e.message,payload:e.payload});for(var t=e[0],r=[],i=0;i<t.length;i++)if(h){var s=A(t[i].message,u),c=t[i].timetoken;try{r.push({message:JSON.parse(s),timetoken:c})}catch(l){r.push({message:s,timetoken:c})}}else{var s=A(t[i],u);try{r.push(JSON.parse(s))}catch(l){r.push(s)}}n([r,e[1],e[2]])},fail:function(e){F(e,a)},url:[pe,"v2","history","sub-key",ae,"channel",v(c)]})):qe("Missing Subscribe Key"):qe("Missing Callback"):qe("Missing Channel")},replay:function(e,n){var r,n=n||e.callback||function(){},i=e.auth_key||se,o=e.source,a=e.destination,s=e.stop,u=e.start,c=e.end,l=e.reverse,f=e.limit,p=He(),h={};return o?a?oe?ae?("0"!=p&&(h.callback=p),s&&(h.stop="all"),l&&(h.reverse="true"),u&&(h.start=u),c&&(h.end=c),f&&(h.count=f),h.auth=i,r=[pe,"v1","replay",oe,ae,o,a],void xdr({callback:p,success:function(e){X(e,n,err)},fail:function(){n([0,"Disconnected"])},url:r,data:t(h)})):qe("Missing Subscribe Key"):qe("Missing Publish Key"):qe("Missing Destination Channel"):qe("Missing Source Channel")},auth:function(e){se=e,de()},time:function(e){var n=He(),r={uuid:Ne,auth:se};Ke&&(r.instanceid=Ue),M.performHTTP({callback:n,data:t(r),url:[pe,"time",n],success:function(n){e(n[0])},fail:function(){e(0)}})},publish:function(e,n){var r=e.message;if(!r)return qe("Missing Message");var i,o,n=n||e.callback||r.callback||function(){},a=e.channel||r.channel,s=e.auth_key||se,u=e.cipher_key,c=e.error||r.error||function(){},l=e.post||!1,f="store_in_history"in e?e.store_in_history:!0,p=He(),h="push";return e.prepend&&(h="unshift"),a?oe?ae?(r.getPubnubMessage&&(r=r.getPubnubMessage()),r=JSON.stringify(O(r,u)),o=[pe,"publish",oe,ae,0,v(a),p,v(r)],i={uuid:Ne,auth:s},f||(i.store="0"),Ke&&(i.instanceid=Ue),ge[h]({callback:p,url:o,data:t(i),fail:function(e){F(e,c),U(1)},success:function(e){X(e,n,c),U(1)},mode:l?"POST":"GET"}),void U()):qe("Missing Subscribe Key"):qe("Missing Publish Key"):qe("Missing Channel")},unsubscribe:function(e,n){var t=e.channel,r=e.channel_group,i=e.auth_key||se,n=n||e.callback||function(){},o=e.error||function(){};if(xe=0,ke=1,t){var a=y((t.join?t.join(","):""+t).split(","),function(e){return we[e]?e:void 0}).join(",");t=y((t.join?t.join(","):""+t).split(","),function(e){return we[e]?e+","+e+P:void 0}).join(","),g(t.split(","),function(e){e&&(we[e]=0,e in Me&&delete Me[e])});var s=!0;T&&(s=ze.LEAVE(a,0,i,n,o)),s||n({action:"leave"})}if(r){var u=y((r.join?r.join(","):""+r).split(","),function(e){return Oe[e]?e:void 0}).join(",");r=y((r.join?r.join(","):""+r).split(","),function(e){return Oe[e]?e+","+e+P:void 0}).join(","),g(r.split(","),function(e){e&&(Oe[e]=0,e in Me&&delete Me[e])});var s=!0;T&&(s=ze.LEAVE_GROUP(u,0,i,n,o)),s||n({action:"leave"})}de()},subscribe:function(e,n){function r(e){e?p(de,O):(pe=N(fe,1),he=N(fe,1),p(function(){ze.time(r)},q)),J(function(n){return e&&n.disconnected?(n.disconnected=0,n.reconnect(n.name)):void(e||n.disconnected||(n.disconnected=1,n.disconnect(n.name)))}),G(function(n){return e&&n.disconnected?(n.disconnected=0,n.reconnect(n.name)):void(e||n.disconnected||(n.disconnected=1,n.disconnect(n.name)))})}function i(){var e=He(),n=m(we).join(","),a=_(Oe).join(",");if(n||a){n||(n=","),V();var s=t({uuid:Ne,auth:se});a&&(s["channel-group"]=a);var u=JSON.stringify(Me);u.length>2&&(s.state=JSON.stringify(Me)),Te&&(s.heartbeat=Te),Ke&&(s.instanceid=Ue),K(),_e=xdr({timeout:w,callback:e,fail:function(e){e&&e.error&&e.service?(F(e,h),r(1)):ze.time(function(n){!n&&F(e,h),r(n)})},data:t(s),url:[he,"subscribe",ae,v(n),e,xe],success:function(e){if(!e||"object"==("undefined"==typeof e?"undefined":o(e))&&"error"in e&&e.error)return h(e.error),p(de,q);if(d(e[1]),xe=!xe&&ke&&Re.get(ae)||e[1],J(function(e){e.connected||(e.connected=1,e.connect(e.name))}),G(function(e){e.connected||(e.connected=1,e.connect(e.name))}),je&&!ke)return xe=0,je=!1,Re.set(ae,0),void p(i,O);x&&(xe=1e4,x=0),Re.set(ae,e[1]);var n=function(){var n="",t="";e.length>3?(n=e[3],t=e[2]):n=e.length>2?e[2]:y(m(we),function(n){return y(Array(e[0].length).join(",").split(","),function(){return n})}).join(",");var r=n.split(","),i=t?t.split(","):[];return function(){var e=r.shift()||me,n=i.shift(),t={};n?(e&&e.indexOf("-pnpres")>=0&&n.indexOf("-pnpres")<0&&(n+="-pnpres"),t=Oe[n]||we[n]||{callback:function(){}}):t=we[e];var o=[t.callback||ve,e.split(P)[0]];return n&&o.push(n.split(P)[0]),o}}(),t=W(+e[1]);g(e[0],function(r){var i=n(),o=A(r,we[i[1]]?we[i[1]].cipher_key:null);i[0]&&i[0](o,e,i[2]||i[1],t,i[1])}),p(i,O)}})}}var a=e.channel,u=e.channel_group,n=n||e.callback,n=n||e.message,c=e.connect||function(){},l=e.reconnect||function(){},f=e.disconnect||function(){},h=e.error||h||function(){},d=e.idle||function(){},b=e.presence||0,k=e.noheresync||0,x=e.backfill||0,j=e.timetoken||0,w=e.timeout||ne,O=e.windowing||ee,M=e.state,L=e.heartbeat||e.pnexpires,S=e.heartbeat_interval,E=e.restore||ke;return se=e.auth_key||se,ke=E,xe=j,a||u?n?ae?((L||0===L||S||0===S)&&ze.set_heartbeat(L,S),a&&g((a.join?a.join(","):""+a).split(","),function(r){var i=we[r]||{};we[me=r]={name:r,connected:i.connected,disconnected:i.disconnected,subscribed:1,callback:ve=n,cipher_key:e.cipher_key,connect:c,disconnect:f,reconnect:l},M&&(r in M?Me[r]=M[r]:Me[r]=M),b&&(ze.subscribe({channel:r+P,callback:b,restore:E}),i.subscribed||k||ze.here_now({channel:r,data:t({uuid:Ne,auth:se}),callback:function(e){g("uuids"in e?e.uuids:[],function(n){b({action:"join",uuid:n,timestamp:Math.floor(s()/1e3),occupancy:e.occupancy||1},e,r)})}}))}),u&&g((u.join?u.join(","):""+u).split(","),function(r){var i=Oe[r]||{};Oe[r]={name:r,connected:i.connected,disconnected:i.disconnected,subscribed:1,callback:ve=n,cipher_key:e.cipher_key,connect:c,disconnect:f,reconnect:l},b&&(ze.subscribe({channel_group:r+P,callback:b,restore:E,auth_key:se}),i.subscribed||k||ze.here_now({channel_group:r,data:t({uuid:Ne,auth:se}),callback:function(e){g("uuids"in e?e.uuids:[],function(n){b({action:"join",uuid:n,timestamp:Math.floor(s()/1e3),occupancy:e.occupancy||1},e,r)})}}))}),de=function(){V(),p(i,O)},T?void de():C.push(de)):qe("Missing Subscribe Key"):qe("Missing Callback"):qe("Missing Channel")},here_now:function(e,n){var n=e.callback||n,r=e.debug,i=e.error||function(){},o=e.auth_key||se,a=e.channel,s=e.channel_group,u=He(),c="uuids"in e?e.uuids:!0,l=e.state,f={uuid:Ne,auth:o};if(c||(f.disable_uuids=1),l&&(f.state=1),!n)return qe("Missing Callback");if(!ae)return qe("Missing Subscribe Key");var p=[pe,"v2","presence","sub_key",ae];a&&p.push("channel")&&p.push(v(a)),"0"!=u&&(f.callback=u),s&&(f["channel-group"]=s,!a&&p.push("channel")&&p.push(",")),Ke&&(f.instanceid=Ue),xdr({callback:u,data:t(f),success:function(e){X(e,n,i)},fail:function(e){F(e,i)},debug:r,url:p})},where_now:function(e,n){var n=e.callback||n,r=e.error||function(){},i=e.auth_key||se,o=He(),a=e.uuid||Ne,s={auth:i};return n?ae?("0"!=o&&(s.callback=o),Ke&&(s.instanceid=Ue),void xdr({callback:o,data:t(s),success:function(e){X(e,n,r)},fail:function(e){F(e,r)},url:[pe,"v2","presence","sub_key",ae,"uuid",v(a)]})):qe("Missing Subscribe Key"):qe("Missing Callback")},state:function $e(e,n){var r,n=e.callback||n||function(e){},i=e.error||function(){},o=e.auth_key||se,a=He(),$e=e.state,s=e.uuid||Ne,u=e.channel,c=e.channel_group,l=t({auth:o});return ae?s?u||c?("0"!=a&&(l.callback=a),"undefined"!=typeof u&&we[u]&&we[u].subscribed&&$e&&(Me[u]=$e),"undefined"!=typeof c&&Oe[c]&&Oe[c].subscribed&&($e&&(Me[c]=$e),l["channel-group"]=c,u||(u=",")),l.state=JSON.stringify($e),Ke&&(l.instanceid=Ue),r=$e?[pe,"v2","presence","sub-key",ae,"channel",u,"uuid",s,"data"]:[pe,"v2","presence","sub-key",ae,"channel",u,"uuid",v(s)],void xdr({callback:a,data:t(l),success:function(e){X(e,n,i)},fail:function(e){F(e,i)},url:r})):qe("Missing Channel"):qe("Missing UUID"):qe("Missing Subscribe Key")},grant:function(e,n){var n=e.callback||n,r=e.error||function(){},i=e.channel||e.channels,o=e.channel_group,a=He(),s=e.ttl,u=e.read?"1":"0",c=e.write?"1":"0",l=e.manage?"1":"0",f=e.auth_key||e.auth_keys;if(!n)return qe("Missing Callback");if(!ae)return qe("Missing Subscribe Key");if(!oe)return qe("Missing Publish Key");if(!ue)return qe("Missing Secret Key");var p=Math.floor((new Date).getTime()/1e3),h=ae+"\n"+oe+"\ngrant\n",g={w:c,r:u,timestamp:p};e.manage&&(g.m=l),d(i)&&(i=i.join(",")),d(f)&&(f=f.join(",")),"undefined"!=typeof i&&null!=i&&i.length>0&&(g.channel=i),"undefined"!=typeof o&&null!=o&&o.length>0&&(g["channel-group"]=o),"0"!=a&&(g.callback=a),(s||0===s)&&(g.ttl=s),f&&(g.auth=f),g=t(g),f||delete g.auth,h+=j(g);var y=ce(h,ue);y=y.replace(/\+/g,"-"),y=y.replace(/\//g,"_"),g.signature=y,xdr({callback:a,data:g,success:function(e){X(e,n,r)},fail:function(e){F(e,r)},url:[pe,"v1","auth","grant","sub-key",ae]})},mobile_gw_provision:function(e){var n,t,r=e.callback||function(){},i=e.auth_key||se,o=e.error||function(){},a=He(),s=e.channel,u=e.op,c=e.gw_type,l=e.device_id;return l?c?u?s?oe?ae?(t=[pe,"v1/push/sub-key",ae,"devices",l],n={uuid:Ne,auth:i,type:c},"add"==u?n.add=s:"remove"==u&&(n.remove=s),Ke&&(data.instanceid=Ue),void xdr({callback:a,data:n,success:function(e){X(e,r,o)},fail:function(e){F(e,o)},url:t})):qe("Missing Subscribe Key"):qe("Missing Publish Key"):qe("Missing gw destination Channel (channel)"):qe("Missing GW Operation (op: add or remove)"):qe("Missing GW Type (gw_type: gcm or apns)"):qe("Missing Device ID (device_id)")},audit:function(e,n){var n=e.callback||n,r=e.error||function(){},i=e.channel,o=e.channel_group,a=e.auth_key,s=He();if(!n)return qe("Missing Callback");if(!ae)return qe("Missing Subscribe Key");if(!oe)return qe("Missing Publish Key");if(!ue)return qe("Missing Secret Key");var u=Math.floor((new Date).getTime()/1e3),c=ae+"\n"+oe+"\naudit\n",l={timestamp:u};"0"!=s&&(l.callback=s),"undefined"!=typeof i&&null!=i&&i.length>0&&(l.channel=i),"undefined"!=typeof o&&null!=o&&o.length>0&&(l["channel-group"]=o),a&&(l.auth=a),l=t(l),a||delete l.auth,c+=j(l);var f=ce(c,ue);f=f.replace(/\+/g,"-"),f=f.replace(/\//g,"_"),l.signature=f,xdr({callback:s,data:l,success:function(e){X(e,n,r)},fail:function(e){F(e,r)},url:[pe,"v1","auth","audit","sub-key",ae]})},revoke:function(e,n){e.read=!1,e.write=!1,ze.grant(e,n)},set_uuid:function(e){Ne=e,de()},get_uuid:function(){return Ne},isArray:function(e){return d(e)},get_subscibed_channels:function(){return m(we,!0)},presence_heartbeat:function(e){var n=e.callback||function(){},r=e.error||function(){},i=He(),o={uuid:Ne,auth:se},a=JSON.stringify(Me);a.length>2&&(o.state=JSON.stringify(Me)),Te>0&&320>Te&&(o.heartbeat=Te),"0"!=i&&(o.callback=i);var s=v(m(we,!0).join(",")),u=_(Oe,!0).join(",");s||(s=","),u&&(o["channel-group"]=u),Ke&&(o.instanceid=Ue),xdr({callback:i,data:t(o),url:[pe,"v2","presence","sub-key",ae,"channel",s,"heartbeat"],success:function(e){X(e,n,r)},fail:function(e){F(e,r)}})},stop_timers:function(){clearTimeout(Y),clearTimeout(Z),clearTimeout(Ae)},shutdown:function(){ze.stop_timers(),Ge&&Ge()},ready:x,db:Re,uuid:h,map:y,each:g,"each-channel":J,grep:l,offline:function(){V(1,{message:"Offline. Please check your network settings."})},supplant:f,now:s,unique:a,updater:c};return Ne||(Ne=ze.uuid()),Ue||(Ue=ze.uuid()),Re.set(ae+"uuid",Ne),Y=p(B,q),Z=p($,te),Ae=p(K,(Ce-3)*q),Q(),ze}Object.defineProperty(r,"__esModule",{value:!0}),r.PN_API=j;var w=e("../package.json"),O=e("./networking"),M=i(O),A=1,T=!1,C=[],P="-pnpres",L=10,S=310,E=60,q=1e3,D=5,H=30,R=w.version,I=/{([\w\-]+)}/g,N=function(){var e=20,n=Math.floor(Math.random()*e);return function(t,r){return t.indexOf("pubsub.")>0&&t.replace("pubsub","ps"+(r?h().split("-")[0]:++n<e?n:n=1))||t}}()},{"../package.json":25,"./networking":2}],2:[function(e,n,t){"use strict";function r(e){var n=i(e),t=o(e.url,n),r=e.success,a=e.fail;console.log(t),s.get(t).buffer(!0).on("error",a).end(function(e,n){var t=JSON.parse(n.text);console.log(t),r(t)})}function i(e){var n=e.data;return n}function o(e,n){var t=e.join(a);return c(n)||(t+="?"+u.stringify(n)),t}Object.defineProperty(t,"__esModule",{value:!0}),t.performHTTP=r;var a="/",s=e("superAgent"),u=e("query-string"),c=e("lodash/lang/isEmpty")},{"lodash/lang/isEmpty":14,"query-string":21,superAgent:24}],3:[function(e,n,t){function r(e){return e?i(e):void 0}function i(e){for(var n in r.prototype)e[n]=r.prototype[n];return e}n.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,n){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(n),this},r.prototype.once=function(e,n){function t(){r.off(e,t),n.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},t.fn=n,this.on(e,t),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,n){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t=this._callbacks[e];if(!t)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===n||r.fn===n){t.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var n=[].slice.call(arguments,1),t=this._callbacks[e];if(t){t=t.slice(0);for(var r=0,i=t.length;i>r;++r)t[r].apply(this,n)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],4:[function(e,n,t){function r(e){return function(n){return null==n?void 0:n[e]}}n.exports=r},{}],5:[function(e,n,t){var r=e("./baseProperty"),i=r("length");n.exports=i},{"./baseProperty":4}],6:[function(e,n,t){function r(e,n){var t=null==e?void 0:e[n];return i(t)?t:void 0}var i=e("../lang/isNative");n.exports=r},{"../lang/isNative":16}],7:[function(e,n,t){function r(e){return null!=e&&o(i(e))}var i=e("./getLength"),o=e("./isLength");n.exports=r},{"./getLength":5,"./isLength":9}],8:[function(e,n,t){function r(e,n){return e="number"==typeof e||i.test(e)?+e:-1,n=null==n?o:n,e>-1&&e%1==0&&n>e}var i=/^\d+$/,o=9007199254740991;n.exports=r},{}],9:[function(e,n,t){function r(e){return"number"==typeof e&&e>-1&&e%1==0&&i>=e}var i=9007199254740991;n.exports=r},{}],10:[function(e,n,t){function r(e){return!!e&&"object"==typeof e}n.exports=r},{}],11:[function(e,n,t){function r(e){for(var n=u(e),t=n.length,r=t&&e.length,c=!!r&&s(r)&&(o(e)||i(e)),f=-1,p=[];++f<t;){var h=n[f];(c&&a(h,r)||l.call(e,h))&&p.push(h)}return p}var i=e("../lang/isArguments"),o=e("../lang/isArray"),a=e("./isIndex"),s=e("./isLength"),u=e("../object/keysIn"),c=Object.prototype,l=c.hasOwnProperty;n.exports=r},{"../lang/isArguments":12,"../lang/isArray":13,"../object/keysIn":20,"./isIndex":8,"./isLength":9}],12:[function(e,n,t){function r(e){return o(e)&&i(e)&&s.call(e,"callee")&&!u.call(e,"callee")}var i=e("../internal/isArrayLike"),o=e("../internal/isObjectLike"),a=Object.prototype,s=a.hasOwnProperty,u=a.propertyIsEnumerable;n.exports=r},{"../internal/isArrayLike":7,"../internal/isObjectLike":10}],13:[function(e,n,t){var r=e("../internal/getNative"),i=e("../internal/isLength"),o=e("../internal/isObjectLike"),a="[object Array]",s=Object.prototype,u=s.toString,c=r(Array,"isArray"),l=c||function(e){return o(e)&&i(e.length)&&u.call(e)==a};n.exports=l},{"../internal/getNative":6,"../internal/isLength":9,"../internal/isObjectLike":10}],14:[function(e,n,t){function r(e){return null==e?!0:a(e)&&(o(e)||c(e)||i(e)||u(e)&&s(e.splice))?!e.length:!l(e).length}var i=e("./isArguments"),o=e("./isArray"),a=e("../internal/isArrayLike"),s=e("./isFunction"),u=e("../internal/isObjectLike"),c=e("./isString"),l=e("../object/keys");n.exports=r},{"../internal/isArrayLike":7,"../internal/isObjectLike":10,"../object/keys":19,"./isArguments":12,"./isArray":13,"./isFunction":15,"./isString":18}],15:[function(e,n,t){function r(e){return i(e)&&s.call(e)==o}var i=e("./isObject"),o="[object Function]",a=Object.prototype,s=a.toString;n.exports=r},{"./isObject":17}],16:[function(e,n,t){function r(e){return null==e?!1:i(e)?l.test(u.call(e)):o(e)&&a.test(e)}var i=e("./isFunction"),o=e("../internal/isObjectLike"),a=/^\[object .+?Constructor\]$/,s=Object.prototype,u=Function.prototype.toString,c=s.hasOwnProperty,l=RegExp("^"+u.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=r},{"../internal/isObjectLike":10,"./isFunction":15}],17:[function(e,n,t){function r(e){var n=typeof e;return!!e&&("object"==n||"function"==n)}n.exports=r},{}],18:[function(e,n,t){function r(e){return"string"==typeof e||i(e)&&s.call(e)==o}var i=e("../internal/isObjectLike"),o="[object String]",a=Object.prototype,s=a.toString;n.exports=r},{"../internal/isObjectLike":10}],19:[function(e,n,t){var r=e("../internal/getNative"),i=e("../internal/isArrayLike"),o=e("../lang/isObject"),a=e("../internal/shimKeys"),s=r(Object,"keys"),u=s?function(e){var n=null==e?void 0:e.constructor;return"function"==typeof n&&n.prototype===e||"function"!=typeof e&&i(e)?a(e):o(e)?s(e):[]}:a;n.exports=u},{"../internal/getNative":6,"../internal/isArrayLike":7,"../internal/shimKeys":11,"../lang/isObject":17}],20:[function(e,n,t){function r(e){if(null==e)return[];u(e)||(e=Object(e));var n=e.length;n=n&&s(n)&&(o(e)||i(e))&&n||0;for(var t=e.constructor,r=-1,c="function"==typeof t&&t.prototype===e,f=Array(n),p=n>0;++r<n;)f[r]=r+"";for(var h in e)p&&a(h,n)||"constructor"==h&&(c||!l.call(e,h))||f.push(h);return f}var i=e("../lang/isArguments"),o=e("../lang/isArray"),a=e("../internal/isIndex"),s=e("../internal/isLength"),u=e("../lang/isObject"),c=Object.prototype,l=c.hasOwnProperty;n.exports=r},{"../internal/isIndex":8,"../internal/isLength":9,"../lang/isArguments":12,"../lang/isArray":13,"../lang/isObject":17}],21:[function(e,n,t){"use strict";var r=e("strict-uri-encode");t.extract=function(e){return e.split("?")[1]||""},t.parse=function(e){return"string"!=typeof e?{}:(e=e.trim().replace(/^(\?|#|&)/,""),e?e.split("&").reduce(function(e,n){var t=n.replace(/\+/g," ").split("="),r=t.shift(),i=t.length>0?t.join("="):void 0;return r=decodeURIComponent(r),i=void 0===i?null:decodeURIComponent(i),e.hasOwnProperty(r)?Array.isArray(e[r])?e[r].push(i):e[r]=[e[r],i]:e[r]=i,e},{}):{})},t.stringify=function(e){return e?Object.keys(e).sort().map(function(n){var t=e[n];return void 0===t?"":null===t?n:Array.isArray(t)?t.sort().map(function(e){return r(n)+"="+r(e)}).join("&"):r(n)+"="+r(t)}).filter(function(e){return e.length>0}).join("&"):""}},{"strict-uri-encode":23}],22:[function(e,n,t){n.exports=function(e,n,t){for(var r=0,i=e.length,o=3==arguments.length?t:e[r++];i>r;)o=n.call(null,o,e[r],++r,e);return o}},{}],23:[function(e,n,t){"use strict";n.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}},{}],24:[function(e,n,t){function r(){}function i(e){var n={}.toString.call(e);switch(n){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function o(e){return e===Object(e)}function a(e){if(!o(e))return e;var n=[];for(var t in e)null!=e[t]&&s(n,t,e[t]);return n.join("&")}function s(e,n,t){return Array.isArray(t)?t.forEach(function(t){s(e,n,t)}):void e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))}function u(e){for(var n,t,r={},i=e.split("&"),o=0,a=i.length;a>o;++o)t=i[o],n=t.split("="),r[decodeURIComponent(n[0])]=decodeURIComponent(n[1]);return r}function c(e){var n,t,r,i,o=e.split(/\r?\n/),a={};o.pop();for(var s=0,u=o.length;u>s;++s)t=o[s],n=t.indexOf(":"),r=t.slice(0,n).toLowerCase(),i=_(t.slice(n+1)),a[r]=i;return a}function l(e){return/[\/+]json\b/.test(e)}function f(e){return e.split(/ *; */).shift()}function p(e){return m(e.split(/ *; */),function(e,n){var t=n.split(/ *= */),r=t.shift(),i=t.shift();return r&&i&&(e[r]=i),e},{})}function h(e,n){n=n||{},this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=c(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function d(e,n){var t=this;v.call(this),this._query=this._query||[],this.method=e,this.url=n,this.header={},this._header={},this.on("end",function(){var e=null,n=null;try{n=new h(t)}catch(r){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=r,e.rawResponse=t.xhr&&t.xhr.responseText?t.xhr.responseText:null,t.callback(e)}if(t.emit("response",n),e)return t.callback(e,n);if(n.status>=200&&n.status<300)return t.callback(e,n);var i=new Error(n.statusText||"Unsuccessful HTTP response");i.original=e,i.response=n,i.status=n.status,t.callback(i,n)})}function g(e,n){return"function"==typeof n?new d("GET",e).end(n):1==arguments.length?new d("GET",e):new d(e,n)}function y(e,n){var t=g("DELETE",e);return n&&t.end(n),t}var b,v=e("emitter"),m=e("reduce");b="undefined"!=typeof window?window:"undefined"!=typeof self?self:this,g.getXHR=function(){if(!(!b.XMLHttpRequest||b.location&&"file:"==b.location.protocol&&b.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1};var _="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};g.serializeObject=a,g.parseString=u,g.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},g.serialize={"application/x-www-form-urlencoded":a,"application/json":JSON.stringify},g.parse={"application/x-www-form-urlencoded":u,"application/json":JSON.parse},h.prototype.get=function(e){return this.header[e.toLowerCase()]},h.prototype.setHeaderProperties=function(e){var n=this.header["content-type"]||"";this.type=f(n);var t=p(n);for(var r in t)this[r]=t[r];
},h.prototype.parseBody=function(e){var n=g.parse[this.type];return n&&e&&(e.length||e instanceof Object)?n(e):null},h.prototype.setStatusProperties=function(e){1223===e&&(e=204);var n=e/100|0;this.status=this.statusCode=e,this.statusType=n,this.info=1==n,this.ok=2==n,this.clientError=4==n,this.serverError=5==n,this.error=4==n||5==n?this.toError():!1,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.notFound=404==e,this.forbidden=403==e},h.prototype.toError=function(){var e=this.req,n=e.method,t=e.url,r="cannot "+n+" "+t+" ("+this.status+")",i=new Error(r);return i.status=this.status,i.method=n,i.url=t,i},g.Response=h,v(d.prototype),d.prototype.use=function(e){return e(this),this},d.prototype.timeout=function(e){return this._timeout=e,this},d.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},d.prototype.abort=function(){return this.aborted?void 0:(this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this)},d.prototype.set=function(e,n){if(o(e)){for(var t in e)this.set(t,e[t]);return this}return this._header[e.toLowerCase()]=n,this.header[e]=n,this},d.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},d.prototype.getHeader=function(e){return this._header[e.toLowerCase()]},d.prototype.type=function(e){return this.set("Content-Type",g.types[e]||e),this},d.prototype.parse=function(e){return this._parser=e,this},d.prototype.accept=function(e){return this.set("Accept",g.types[e]||e),this},d.prototype.auth=function(e,n){var t=btoa(e+":"+n);return this.set("Authorization","Basic "+t),this},d.prototype.query=function(e){return"string"!=typeof e&&(e=a(e)),e&&this._query.push(e),this},d.prototype.field=function(e,n){return this._formData||(this._formData=new b.FormData),this._formData.append(e,n),this},d.prototype.attach=function(e,n,t){return this._formData||(this._formData=new b.FormData),this._formData.append(e,n,t),this},d.prototype.send=function(e){var n=o(e),t=this.getHeader("Content-Type");if(n&&o(this._data))for(var r in e)this._data[r]=e[r];else"string"==typeof e?(t||this.type("form"),t=this.getHeader("Content-Type"),"application/x-www-form-urlencoded"==t?this._data=this._data?this._data+"&"+e:e:this._data=(this._data||"")+e):this._data=e;return!n||i(e)?this:(t||this.type("json"),this)},d.prototype.callback=function(e,n){var t=this._callback;this.clearTimeout(),t(e,n)},d.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},d.prototype.timeoutError=function(){var e=this._timeout,n=new Error("timeout of "+e+"ms exceeded");n.timeout=e,this.callback(n)},d.prototype.withCredentials=function(){return this._withCredentials=!0,this},d.prototype.end=function(e){var n=this,t=this.xhr=g.getXHR(),o=this._query.join("&"),a=this._timeout,s=this._formData||this._data;this._callback=e||r,t.onreadystatechange=function(){if(4==t.readyState){var e;try{e=t.status}catch(r){e=0}if(0==e){if(n.timedout)return n.timeoutError();if(n.aborted)return;return n.crossDomainError()}n.emit("end")}};var u=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),n.emit("progress",e)};this.hasListeners("progress")&&(t.onprogress=u);try{t.upload&&this.hasListeners("progress")&&(t.upload.onprogress=u)}catch(c){}if(a&&!this._timer&&(this._timer=setTimeout(function(){n.timedout=!0,n.abort()},a)),o&&(o=g.serializeObject(o),this.url+=~this.url.indexOf("?")?"&"+o:"?"+o),t.open(this.method,this.url,!0),this._withCredentials&&(t.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof s&&!i(s)){var f=this.getHeader("Content-Type"),p=this._parser||g.serialize[f?f.split(";")[0]:""];!p&&l(f)&&(p=g.serialize["application/json"]),p&&(s=p(s))}for(var h in this.header)null!=this.header[h]&&t.setRequestHeader(h,this.header[h]);return this.emit("request",this),t.send("undefined"!=typeof s?s:null),this},d.prototype.then=function(e,n){return this.end(function(t,r){t?n(t):e(r)})},g.Request=d,g.get=function(e,n,t){var r=g("GET",e);return"function"==typeof n&&(t=n,n=null),n&&r.query(n),t&&r.end(t),r},g.head=function(e,n,t){var r=g("HEAD",e);return"function"==typeof n&&(t=n,n=null),n&&r.send(n),t&&r.end(t),r},g.del=y,g["delete"]=y,g.patch=function(e,n,t){var r=g("PATCH",e);return"function"==typeof n&&(t=n,n=null),n&&r.send(n),t&&r.end(t),r},g.post=function(e,n,t){var r=g("POST",e);return"function"==typeof n&&(t=n,n=null),n&&r.send(n),t&&r.end(t),r},g.put=function(e,n,t){var r=g("PUT",e);return"function"==typeof n&&(t=n,n=null),n&&r.send(n),t&&r.end(t),r},n.exports=g},{emitter:3,reduce:22}],25:[function(e,n,t){n.exports={name:"reworked_core",version:"1.0.0",description:"",main:"index.js",scripts:{test:'echo "Error: no test specified" && exit 1'},author:"",license:"ISC",devDependencies:{"babel-preset-es2015":"^6.3.13",browserify:"^12.0.1",gulp:"^3.9.0","gulp-babel":"^6.1.1","gulp-rename":"^1.2.2","gulp-sourcemaps":"^1.6.0","gulp-uglify":"^1.5.1","gulp-util":"^3.0.7","run-sequence":"^1.1.5","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0"},dependencies:{lodash:"^3.10.1","query-string":"^3.0.0",request:"^2.67.0",superagent:"^1.6.1",underscore:"^1.8.3"}}},{}]},{},[1]);
//# sourceMappingURL=pubnub.js.map
